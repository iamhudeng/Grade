<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>충남과학고 내신 엑셀 생성기</title>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    input { width: 4rem; text-align: center; margin: 0.2rem; }
    .grid { display: grid; grid-template-columns: repeat(4, max-content); gap: 0.5rem; align-items: center; }
  </style>
</head>
<body>
  <h1>성적 입력</h1>

  <label>이름: <input type="text" id="nameInput"></label><br>
  <label>기수: <input type="number" id="classInput"></label>

  <h2>과목별 등수</h2>
  <div class="grid" id="gradeGrid">
    <!-- JS로 과목들 자동 삽입 -->
  </div>

  <br><button onclick="generateExcel()">엑셀 생성 및 다운로드</button>

  <script>
    const subjects = [
      "국어", "영어", "통합사회, 한국사", "정보과학", "중국어",
      "수학", "물리학", "화학", "생명과학", "지구과학"
    ];
    const semesters = ["1학년 1학기", "1학년 2학기", "2학년 1학기"];

    const gradeGrid = document.getElementById("gradeGrid");
    subjects.forEach((subject, rowIndex) => {
      const label = document.createElement("div");
      label.textContent = subject;
      gradeGrid.appendChild(label);
      semesters.forEach((sem, colIndex) => {
        const input = document.createElement("input");
        input.type = "number";
        input.id = `grade-${rowIndex}-${colIndex}`;
        gradeGrid.appendChild(input);
      });
    });

    async function generateExcel() {
      const name = document.getElementById("nameInput").value;
      const cls = document.getElementById("classInput").value;

      // 1. 엑셀 템플릿 fetch
      const response = await fetch("만들어보자.xlsx");
      const data = await response.arrayBuffer();
      const workbook = XLSX.read(data, { type: "array" });

      // 2. 시트 선택
      const sheet = workbook.Sheets[workbook.SheetNames[0]];

      // 3. 이름, 기수 입력 (C2, C3)
      sheet["C2"] = { v: name };
      sheet["C3"] = { v: Number(cls) };

      // 4. 등수 입력 (C6~E15)
      for (let row = 0; row < subjects.length; row++) {
        for (let col = 0; col < semesters.length; col++) {
          const cellAddress = XLSX.utils.encode_cell({ c: 2 + col, r: 5 + row }); // C=2, D=3, E=4 / row 5 = C6
          const input = document.getElementById(`grade-${row}-${col}`);
          const val = Number(input.value);
          if (!isNaN(val)) {
            sheet[cellAddress] = { v: val };
          }
        }
      }

      // 5. 새 엑셀 생성 및 다운로드
      const newWorkbook = XLSX.write(workbook, { bookType: "xlsx", type: "array" });
      const blob = new Blob([newWorkbook], { type: "application/octet-stream" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "업데이트된_내신.xlsx";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
