<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>충남과학고 내신 분석기</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 40px;
        }
        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        .section {
            margin-bottom: 2rem;
        }
        .section h2 {
            margin-top: 1rem;
            font-size: 1.2rem;
        }
        input {
            width: 4rem;
            padding: 0.3rem;
            margin: 0.2rem;
            text-align: center;
            -moz-appearance: textfield;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body>
    <h1>충남과학고 2학년 내신 분석기</h1>

    <div class="section">
        <h2>1학년 1학기</h2>
        국어 : <input type="number" class="grade-1-1"><br>
        수학 : <input type="number" class="grade-1-1"><br>
        영어 : <input type="number" class="grade-1-1"><br>
        통합사회 : <input type="number" class="grade-1-1"><br>
        통합과학 : <input type="number" class="grade-1-1"><br>
        물리학 I : <input type="number" class="grade-1-1"><br>
        화학 I : <input type="number" class="grade-1-1"><br>
        정보과학 : <input type="number" class="grade-1-1">
    </div>

    <div class="section">
        <h2>1학년 2학기</h2>
        국어 : <input type="number" class="grade-1-2"><br>
        영어 : <input type="number" class="grade-1-2"><br>
        통합사회 : <input type="number" class="grade-1-2"><br>
        생명과학 I : <input type="number" class="grade-1-2"><br>
        지구과학 I : <input type="number" class="grade-1-2"><br>
        정보과학 : <input type="number" class="grade-1-2"><br>
        심화 수학 I : <input type="number" class="grade-1-2"><br>
        고급 물리학 : <input type="number" class="grade-1-2"><br>
        고급 화학 : <input type="number" class="grade-1-2">
    </div>

    <div class="section">
        <h2>2학년 1학기</h2>
        독서 : <input type="number" class="grade-2-1"><br>
        영어 I : <input type="number" class="grade-2-1"><br>
        한국사 : <input type="number" class="grade-2-1"><br>
        중국어 I : <input type="number" class="grade-2-1"><br>
        심화 수학 II : <input type="number" class="grade-2-1"><br>
        고급 물리학 : <input type="number" class="grade-2-1"><br>
        고급 화학 : <input type="number" class="grade-2-1"><br>
        고급 생명과학 : <input type="number" class="grade-2-1"><br>
        고급 지구과학 : <input type="number" class="grade-2-1">
    </div>

    <button onclick="calculateGrades()">등급 계산하기</button>

    <script>
        function getGrade(rank, total) {
    const gradeRanges = {
        72: [3, 8, 17, 29, 43, 55, 64, 69, 72],
        70: [3, 8, 16, 28, 42, 54, 62, 67, 70],
        69: [3, 8, 16, 28, 41, 53, 61, 66, 69]
    };

    const ranges = gradeRanges[total];
    for (let i = 0; i < ranges.length; i++) {
        if (rank <= ranges[i]) {
            return i + 1;
        }
    }
    return 9;
}

function calculateGrades() {
    const sections = [
        { className: 'grade-1-1', total: 72, title: "1학년 1학기", subjects: ["국어", "수학", "영어", "통합사회", "통합과학", "물리학 I", "화학 I", "정보과학"] },
        { className: 'grade-1-2', total: 70, title: "1학년 2학기", subjects: ["국어", "영어", "통합사회", "생명과학 I", "지구과학 I", "정보과학", "심화 수학 I", "고급 물리학", "고급 화학"] },
        { className: 'grade-2-1', total: 69, title: "2학년 1학기", subjects: ["독서", "영어 I", "한국사", "중국어 I", "심화 수학 II", "고급 물리학", "고급 화학", "고급 생명과학", "고급 지구과학"] }
    ];

    let resultText = "";

    sections.forEach(section => {
        const inputs = document.querySelectorAll('.' + section.className);
        resultText += `${section.title}\n`;

        inputs.forEach((input, i) => {
            const rank = parseInt(input.value);
            if (!isNaN(rank)) {
                const grade = getGrade(rank, section.total);
                resultText += `- ${section.subjects[i]}: ${grade}등급\n`;
                input.style.backgroundColor = '#f0f8ff'; // optional visual cue
            } else {
                resultText += `- ${section.subjects[i]}: 입력 안됨\n`;
                input.style.backgroundColor = ''; // clear color
            }
        });

        resultText += '\n';
    });

    // 결과를 하단에 출력
    document.getElementById("grade-result-output").textContent = resultText;
    drawKoreanChart();
}

document.addEventListener("DOMContentLoaded", () => {
    const allInputs = Array.from(document.querySelectorAll("input[type='number']"));

    allInputs.forEach((input, index) => {
        input.addEventListener("keydown", (e) => {
            if (e.key === "ArrowUp") {
                e.preventDefault();
                if (index > 0) allInputs[index - 1].focus();
            } else if (e.key === "ArrowDown" || e.key === "Enter") {
                e.preventDefault();
                if (index < allInputs.length - 1) allInputs[index + 1].focus();
            }
        });
    });
});

let koreanChartInstance = null;

    function drawKoreanChart() {
        const labels = ["1학년 1학기", "1학년 2학기", "2학년 1학기"];
        const rankInputs = [
            document.querySelectorAll('.grade-1-1')[0],  // 국어
            document.querySelectorAll('.grade-1-2')[0],  // 국어
            document.querySelectorAll('.grade-2-1')[0]   // 독서
        ];

        const ranks = rankInputs.map(input => {
            const val = parseInt(input.value);
            return isNaN(val) ? null : val;
        });

        // 그래프가 이미 있다면 제거
        if (koreanChartInstance) {
            koreanChartInstance.destroy();
        }

        const ctx = document.getElementById('koreanChart').getContext('2d');
        koreanChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: '등수',
                    data: ranks,
                    fill: false,
                    borderColor: 'steelblue',
                    backgroundColor: 'skyblue',
                    tension: 0,
                    spanGaps: true
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '등수'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    </script>

<div class="section">
    <h2>등급 결과</h2>
    <pre id="grade-result-output" style="background: #f9f9f9; padding: 1rem; border: 1px solid #ccc;"></pre>
</div>
    
<div class="section">
    <h2>국어 계열 등수 추이</h2>
    <canvas id="koreanChart" width="200" height="100"></canvas>
</div>

</body>
</html>
